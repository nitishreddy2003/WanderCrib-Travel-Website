<% layout("/layouts/boilerplate") %>


    <h3><%=listing.title%></h3>
   
    
        <div class="card listing-card" style="width: 18rem"  >
            <img src="<%=listing.image %>" class="show-img" alt="listing-image">
          </div>
    
<ul>
    <li><%=listing.description%></li>
    <li><%=listing.price%></li>
    <li><%=listing.location%></li>
    <li><%=listing.country%></li>
</ul>

<% if(currUser && listing._id.equals(currUser._id)) { %>
<a href="\listings\<%=listing._id%>\edit">edit this listing</a>
<br>

<form method="post" action="/listings/<%=listing._id %>?_method=DELETE">
    <button>delete</button>
</form>

<%}%> <% if(currUser) { %>
<div class="col-8 ">
    <hr>
    <h4>Leave a Review</h4>
    <form action="/listings/<%=listing._id%>/reviews" method="post" novalidate class="needs-validation">
        <div>
            <label for="rating">Rating</label>
            <input type="range" min="1" max="5" id="rating" name="review[rating]">
        </div>
        <div>
            <label for="comment">comment</label>
            <textarea name="review[comment]" id="comment" cols="30" rows="5" class="form-control" required></textarea>
        </div>
        <button class="btn-dark">submit</button>
    </form>
    <% } %>
        <hr>
        <h4><b>All Reviews</b></h4>
        <!-- <p><%=listing.reviews%></p> -->
         <div class="row">
        <% for(review of listing.reviews) { %>
            <div class="card col-6">
                <div class="card-body">
                    <h5 class="card-title">
                    <%= review.author && review.author.username ? review.author.username : "Unknown Author" %>
                    </h5>

                    <p class="card-text"><%=review.comment%></p>
                    <p class="card-text"><%=review.rating%></p>
                </div>
                <% if (currUser && review.author && review.author.equals(currUser._id)) { %>
                    
                    <form class="mb-3" method="post" action="/listings/<%= listing._id%>/reviews/<%=review._id%>?_method=DELETE">
                        <button class="button btn-sm btn-dark">Delete</button>
                    </form>
                <% } %>
            </div>
        <% } %>
    </div>

</div>

